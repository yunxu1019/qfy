0ewObject,Array,JSON,keys,location,extend,parseKV,RegExp,serialize,unescape,isString,undefined,navigator,console,document,Promise,isEmpty,Error,Date,cross,Function,enrich,deepEqual,setTimeout,localStorage,sessionStorage,e,g,c,y,J,d,z,K,A,L,B,M,N,h,O,f,P,p,Q,C,i,R,S,T,q,rfunction U(a){var c=a.source,d=a.head,b=a.body;return b instanceof g?b.map(function(b){var a={};return b.map(function(f,g){var b=d[g],e=c[b][f];a[b]=e}),a}):[]}function V(d){if(!d instanceof g)return;var a={};d.map(function(h){for(var b in h){var f=h[b];if(f instanceof e)continue;a[b]||(a[b]={inc:0});var d=a[b],g=c.stringify(f);g in d||(d[g]=d.inc++)}});var b=y(a),f=d.map(function(d){return b.map(function(b){var e=c.stringify(d[b]);return a[b][e]})});return b.map(function(d){var b=a[d];delete b.inc,a[d]=y(b).map(c.parse)}),{source:a,head:b,body:f}}function D(c){var a,b=['id','name','icon'];return c.replace(/#(.*?)$/,function(d,c){return c=c.split('&'),c.forEach(function(f,h){if(f){var c=f.split('=').reverse(),d=c[0],e=c[1],g=e===void 0?b[h]||d:e;a||(a={}),a[g]=d}}),''}),a}function s(a,f,h){if(!f)return a;if(a instanceof g)return a.map(function(a){return s(a,f,h)});b=d({},a&&a.querySelector?null:a);for(var c in f){var e=f[c];c in b||(e in b?(b[c]=b[e],delete b[e]):b[c]=n(a,e,h))}return b}function E(b,c){c===void 0&&(c='?');var a=b.indexOf(c);return a<0||a>=b.length-1?void 0:z(b.slice(a+1))}function W(c,d){var e=/([\s\S]*?)/.source,b=[],f=c.url.replace(/[\?\#][\s\S]*$/,'').replace(/[\.\*\+\-\[\]\{\}\(\)\\\/\!\<\>\^]/g,'\\$&').replace(/\:\w+/,function(a){return b.push(a.slice(1)),e}),a={};return d=d.replace(/[\?#]*$/g,function(b){return b.split(/[&#\?]+/).forEach(function(e){var b=e.split('='),c=b[0],d=b[1];a[c]=d}),''}).replace(new K('^'+f+'$','ig'),function(){var c=arguments;b.forEach(function(b,d){a[b]=c[d+1]})}),a=A(a),c.id+'?'+a}function n(a,b,g){if(g===void 0&&(g={}),a&&a.querySelector){if(!b)return a;b=L(b);var d=/^(\[\]|,)|(\[\]|,)$/g;if(d.test(b))return[].concat.apply([],a.querySelectorAll(b.replace(d,'')));var d=/[\|\?\!\/]/;if(d.test(b))var h=b.split(d),e=h[0],c=h[1];else var e=b;if(e&&(a=a.querySelector(e)),a&&c){var i=/\:/;if(i.test(c)){var j=c.split(i),c=j[0],f=j[1];f=g[f]}return a=a.getAttribute(c)||a[c],B(a)&&/\|/.test(b)&&(a=a.trim()),f&&(a=W(f,a)),a}return a}return b&&b.split('.').forEach(function(b){a!==null&&a!==M&&b in a&&(a=a[b])}),a}function X(b){var d=b.method,i=d===void 0?'':d,e=b.url,f=e===void 0?'':e,g=b.id,c=g===void 0?'':g,h=b.name,j=h===void 0?'':h,k=b.comment,a=[];return c=c.replace(/\?(.+?)$/,function(c,b){return b=b.split('&'),b.forEach(function(e){if(e){var c=e.split('='),b=c[0],d=c[1],f=d===void 0?b:d;a[b]||a.push(b),a[b]=f}}),''}),f.replace(/[\?\#][\s\S]*$/,'').replace(/\:\w+/g,function(b){b=b.slice(1),a[b]||(a.push(b),a[b]=b)}),{method:i,url:f,id:c,name:j,comment:k,required:a}}function Y(a,b){if(!w.test(a.url)&&b){var e=/(?:\?([\s\S]*?))?(?:#([\s\S]*))?$/;if(/[\?#]/.test(b)){var i=e.exec(b),f=i[1],g=i[2];b=b.replace(e,'')}if(/^\.([\?\#][\s\S]*)?$/.test(a.url)?a.url=b+a.url.replace(/^\./,''):a.url=b+a.url,f||g){if(/[\?#]/.test(a.url))var j=e.exec(a.url),c=j[1],d=j[2];var h=a.url.replace(e,'');f&&(c=c?f+'&'+c:f),g&&(d=d?g+'&'+d:g),c&&(h+='?'+c),d&&(h+='#'+d),a.url=h}}a.method=a.method.replace(/^\w+/,function(a){return a.toLowerCase()})}function F(k){function l(b){if(Y(b,i),g.call(a,b.id)){var c=a[b.id];h.warn('\u591a\u6b21\u8bbe\u7f6e\u7684id\u76f8\u540c\u7684api:%c'+b.id,'color:red'),h.log('['+b.name+']('+c.method+' '+b.url+')\r\n \u88ab ['+b.name+']('+c.method+' '+c.url+') \u8986\u76d6')}return a[b.id]=b,b}var a={},g={}.hasOwnProperty,i,c=k;for(var d in c){var b=d.split(/\s+/).filter(function(a){return w.test(a)})[0];if(!b)continue;i=/(https?\:)?|\.?\//i.test(b)?b:'';var f=c[d],j=e.keys(f).map(function(a){return a+' '+f[a]});H.string('id method url name comment',j).map(X).map(l)}return a}var G=this&&this.__extends||function(a){return a=function(b,c){return a=e.setPrototypeOf||{__proto__:[]}instanceof g&&function(a,b){a.__proto__=b}||function(c,b){for(var a in b)b.hasOwnProperty(a)&&(c[a]=b[a])},a(b,c)},function(c,b){function d(){this.constructor=c}a(c,b),c.prototype=b===null?e.create(b):(d.prototype=b.prototype,new d)}}(),t=J.pathname,j={},u={},H={string:function(c,a){if(a instanceof g){var b=c.split(/(?:\s+|,)/);a=a.map(function(a){if(typeof a==='string'){var c={};return a.split(/(?:\s+|,)/).map(function(a,d){return c[b[d]]=a}),c}return a})}return a},'function':function(a,b,c){return a(b,c)}},v=function(a){function b(){var b=a!==null&&a.apply(this,arguments)||this;return b.totalCount=0,b.data=[],b.is_errored=null,b.error_message=null,b.is_loading=!0,b.is_readonly=null,b.loading=null,b.loading_promise=null,b}return G(b,a),b}(g),I=/msie\s+[2-9]/i.test(N.userAgent),k=function(a){if(/^\s*([\{\[]|"|true|\d|false|null)/.test(a))try{return c.parse(a)}catch(a){h.log(a)}if(/^\s*\</i.test(a)){var b=O.implementation.createHTMLDocument('');return I?(a=a.replace(/<!--[\s\S]*?-->|<\[CDATA\[[\s\S]*?\]\]>/ig,'').replace(/^[\s\S]*?<html>([\s\S]*)<\/html>[\s\S]*?$/i,'$1').replace(/^[\s\S]*?<body>([\s\S]*?)$/i,'$1').replace(/<\/body>[\s\S]*?$/,''),b.body.innerHTML=a):b.documentElement.innerHTML=a,b}if(/^[\s\_\.\w\$]+\s*\([\s\S]*\)\s*;?\s*$/.test(a))try{return c.parse(a.replace(/^[^\(]+\(([\s\S]*)\)[^\)]*$/,'$1'))}catch(a){h.log(a)}return a},w=/^(https?\:\/\/|\.?\/)/i,x,l,a={loadAfterConfig:function(c,a){var b=this,d=this.getApi(c).then(function(d){return a=b.pack(c,a),b.fromApi(d,a)});return d},pack:function(a,b){if(/\?/.test(a)&&(b=d({},E(a),b),a=a.replace(/\?[\s\S]*$/,'')),/\:/.test(a)){var f=d({},b),e=E(a,':');for(var g in e){var c=e[g];c in b&&(f[g]=b[c]),c in e||delete f[c]}}return b},fromApi:function(a,b){var c=a.url;return this.validApi(a,b)?this.loadIgnoreConfig(a.method,c,b,a.root):f.resolve()},validApi:function(a,c){if(a.required){var b=a.required;if(c&&(b=b.filter(function(a){return P(c[a])})),b.length)return h.log('\u8df3\u8fc7\u4e86\u7f3a\u5c11\u53c2\u6570\u7684\u8bf7\u6c42:'+a.id+' '+a.name+' '+a.url+'\r\n\u7f3a\u5c11\u53c2\u6570\uff1a'+b.join(', ')),!1}return!0},getApi:function(a){return this.getConfigPromise().then(function(c){a=a.replace(/[\?\:][\s\S]*$/,'');var b=c[a];if(!b)throw new p('\u6ca1\u6709\u627e\u5230\u5bf9\u5e94\u7684\u63a5\u53e3 id '+a+'.');return d({},b,{root:c})})},prepare:function(h,o,a){var b=/[\:\|\/\~\!\?]/.exec(h);b?b=b.index:b=h.length;var k=h.slice(0,b).toLowerCase(),m=k.replace(/\W+$/g,''),c=o.replace(/#[\s\S]*$/,'');if(a=d({},a),/\?/.test(c))var e=c.replace(/^[\s\S]*?\?/,'');var i=[],j=c.replace(/\?[\s\S]*$/,'').replace(/\:[a-z\_][\w]*/i,function(b){return b=b.slice(1),i.push(b),n(a,b)||''}),l={}.hasOwnProperty;if(e){var g=z(e);for(var f in g)l.call(g,f)&&l.call(a,f)&&(g[f]=a[f],i.push(f));e=A(g),c=j+'?'+e}else c=j;return i.forEach(function(b){return delete a[b]}),{method:m,coinmethod:k,selector:h.slice(b+1),search:e,baseuri:j,uri:c,params:a}},loadIgnoreConfig:function(r,l,d,t){var b=this.prepare(r,l,d),e=b.method,m=b.uri,o=b.baseuri,p=b.coinmethod,g=b.search,q=b.selector,d=b.params,h=e+' '+o,a=u[h],i=c.stringify(d),j=+new Q;if(!a||j-a.time>60||i!==a.params||a.search!==g){var a=new f(function(b,a){C(e,m).send(d).done(function(a){b(a.response||a.responseText)}).error(function(b){try{a(k(b.response||b.responseText||b.statusText||b.status))}catch(b){a(b)}})});a.search=g,a.params=i,a.time=j,u[h]=a}return a.then(function(a){return/\*$/.test(p)?a:s(n(k(a),q),D(l),t)})},getConfigPromise:function(){if(!l){if(!x)throw new p('\u6ca1\u6709\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u8bf7\u4f7f\u7528data.loadConfig\u52a0\u8f7d\u914d\u7f6e');l=this.loadIgnoreConfig('get',x).then(F)}return l}},m=0,o=function(){return m++===m&&(m=1),m},b={decodeStructure:U,encodeStructure:V,loading_count:0,loadConfig:function(b){return b&&(x=b,l=null),a.getConfigPromise()},from:function(a,b,c){return b instanceof i&&(c=b,b={}),a instanceof e?this.fromApi(a,b):/^\.*\/|\.\w+$/.test(a)?this.fromURL(a,c):this.asyncInstance(a,b,c)},enrich:function(c,d){if(c===void 0&&(c=l),!c)return;if(B(c))c=a.loadIgnoreConfig('get',c).then(F);else if(!(c instanceof f)){if(!(c instanceof e))return;c=f.resolve(c)}return R({from:function(b,d){return c.then(function(e){var c=e[b];return a.fromApi(c,d)})},queue:function(d,e,g){d=d.slice(0),c.then(function(c){return new f(function(f){var c=function(e){if(!d.length)return f(e);var g=d.pop(),h=b[g];a.fromApi(h,e).then(c)};c(e)})})}})},fromApi:function(f,h,g){var c=this,b=g instanceof i?o():0;b&&this.removeInstance(b);var d=f.url,e=this.getInstance(b||d);return e.loading_promise=a.fromApi(f,h).then(function(a){return b?(c.setInstance(b,g(a),!1),c.removeInstance(b)):c.setInstance(d,a),a}),e},fromURL:function(d,f){var c=this,b=f instanceof i?o():0;b&&this.removeInstance(b);var e=this.getInstance(b||d);return e.loading_promise=a.loadIgnoreConfig('get',d).then(function(a){return b?(c.setInstance(b,f(a),!1),c.removeInstance(b)):c.setInstance(d,a),a}),e},asyncInstance:function(g,k,j){var f=this,c=j instanceof i||k?o():0;c&&this.removeInstance(c);var b=this.getInstance(c||g);b.is_loading=!0,this.loading_count++;var l=b.loading_promise=a.loadAfterConfig(g,k).then(function(a){return f.loading_count--,b.is_loading=!1,c?(f.setInstance(c,j instanceof i?j(a):a,!1),f.removeInstance(c)):f.setInstance(g,a),a});return l['catch'](function(a){h.log(a),f.loading_count--,b.is_errored=!0,b.is_loading=!1,a instanceof e?d(b,a):b.error=a}),b},lazyInstance:function(e,j,l){var h=this,g='.'+e,b=this.getInstance(g),c=b.loading_promise;if(c){var m=c.params;if(S.shallow(j,m))return b}var d=new p('outdate canceled.');return c=b.loading_promise=new f(function(a){T(a,600)}).then(function(){if(c!==b.loading_promise)throw d;return a.getApi(e)}).then(function(h){if(c!==b.loading_promise)throw d;b.loading&&b.loading.abort();var g=a.pack(e,j);if(!a.validApi(h,g))throw d;var i=a.prepare(h.method,h.url,g),l=i.method,m=i.uri,g=i.params,o=i.selector,p=new f(function(c,a){b.loading=C(l,m).send(g).done(function(e){if(b.loading!==e)return a(d);b.loading=null,c(e.responseText||e.response)}).error(function(c){if(b.loading!==c)return a(d);b.loading=null;try{a(k(c.response||c.responseText||c.statusText||c.status))}catch(b){a(b)}})}).then(function(a){return s(n(k(a),o),D(h.url),h.root)});return p}).then(function(a){if(b.loading_promise!==c)return;g?h.setInstance(g,l instanceof i?l(a):a,!1):h.setInstance(e,a)}),c['catch'](function(){}),b},getInstance:function(a,e){if(e===void 0&&(e=!1),!j[a]){var b=j[a]=new v,f=a+t;d(b,c.parse(q.getItem(f))),e||d(b,c.parse(r.getItem(f))),b.is_loading=!1}return j[a]},removeInstance:function(a){delete j[a],q.removeItem(a),r.removeItem(a)},setInstance:function(b,d,a){a===void 0&&(a=0);var f=this.getInstance(b);this.rebuildInstance(f,d);var e=b+t;return a!==!1&&r.setItem(e,c.stringify(d)),a&&q.setItem(e,c.stringify(d)),j[b]},rebuildInstance:function(a,c,b){if(b===void 0&&(b=a),a===c)return;a.splice(0,a.length);var f=new v;e.keys(b).forEach(function(c){a[c]===b[c]&&!(c in f)&&delete a[c]}),d(a,c)}};return b